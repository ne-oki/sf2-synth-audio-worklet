!function(){"use strict";!function(e){function t(){}function n(){}t.prototype.encode=function(e){const t=[],n=e.length;let r=0;for(;r<n;){const n=e.codePointAt(r);let o=0,s=0;for(n<=127?(o=0,s=0):n<=2047?(o=6,s=192):n<=65535?(o=12,s=224):n<=2097151&&(o=18,s=240),t.push(s|n>>o),o-=6;o>=0;)t.push(128|n>>o&63),o-=6;r+=n>=65536?2:1}return t},globalThis.TextEncoder=t,e.TextEncoder||(e.TextEncoder=t),n.prototype.decode=function(e){if(!e)return"";let t="",n=0;for(;n<e.length;){let r=e[n],o=0,s=0;if(r<=127?(o=0,s=255&r):r<=223?(o=1,s=31&r):r<=239?(o=2,s=15&r):r<=244&&(o=3,s=7&r),e.length-n-o>0){let t=0;for(;t<o;)r=e[n+t+1],s=s<<6|63&r,t+=1}else s=65533,o=e.length-n;t+=String.fromCodePoint(s),n+=o+1}return t},globalThis.TextDecoder=n,e.TextDecoder||(e.TextDecoder=n)}("undefined"==typeof globalThis?"undefined"==typeof global?"undefined"==typeof self?void 0:self:global:globalThis);let e;const t=new Array(128).fill(void 0);function n(e){return t[e]}t.push(void 0,null,!0,!1);let r=t.length;function o(e){const o=n(e);return function(e){e<132||(t[e]=r,r=e)}(e),o}function s(e){r===t.length&&t.push(t.length+1);const n=r;return r=t[n],t[n]=e,n}const i="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&i.decode();let c=null;function a(){return null!==c&&0!==c.byteLength||(c=new Uint8Array(e.memory.buffer)),c}function u(e,t){return e>>>=0,i.decode(a().subarray(e,e+t))}function f(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=f(e[0]));for(let r=1;r<t;r++)n+=", "+f(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}let _=0;const l="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},d="function"==typeof l.encodeInto?function(e,t){return l.encodeInto(e,t)}:function(e,t){const n=l.encode(e);return t.set(n),{read:e.length,written:n.length}};function h(e,t,n){if(void 0===n){const n=l.encode(e),r=t(n.length,1)>>>0;return a().subarray(r,r+n.length).set(n),_=n.length,r}let r=e.length,o=t(r,1)>>>0;const s=a();let i=0;for(;i<r;i++){const t=e.charCodeAt(i);if(t>127)break;s[o+i]=t}if(i!==r){0!==i&&(e=e.slice(i)),o=n(o,r,r=i+3*e.length,1)>>>0;const t=a().subarray(o+i,o+r);i+=d(e,t).written}return _=i,o}let g=null;function b(){return null!==g&&0!==g.byteLength||(g=new Int32Array(e.memory.buffer)),g}function w(e){return null==e}class y{static __wrap(e){e>>>=0;const t=Object.create(y.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const t=this.__destroy_into_raw();e.__wbg_wasmsoundfontsynth_free(t)}static new(t,n){const r=function(e,t){const n=t(1*e.length,1)>>>0;return a().set(e,n/1),_=e.length,n}(t,e.__wbindgen_export_0),o=_,s=e.wasmsoundfontsynth_new(r,o,n);return y.__wrap(s)}get_preset_headers(){return o(e.wasmsoundfontsynth_get_preset_headers(this.__wbg_ptr))}program_select(t,n,r){e.wasmsoundfontsynth_program_select(this.__wbg_ptr,t,n,r)}note_on(t,n,r,o){e.wasmsoundfontsynth_note_on(this.__wbg_ptr,t,n,r,!w(o),w(o)?0:o)}note_off(t,n,r){e.wasmsoundfontsynth_note_off(this.__wbg_ptr,t,n,!w(r),w(r)?0:r)}read_next_block(t){return o(e.wasmsoundfontsynth_read_next_block(this.__wbg_ptr,t))}}function p(){const t={wbg:{}};return t.wbg.__wbindgen_object_drop_ref=function(e){o(e)},t.wbg.__wbindgen_object_clone_ref=function(e){return s(n(e))},t.wbg.__wbindgen_number_new=function(e){return s(e)},t.wbg.__wbindgen_string_new=function(e,t){return s(u(e,t))},t.wbg.__wbg_set_20cbc34131e76824=function(e,t,r){n(e)[o(t)]=o(r)},t.wbg.__wbg_new_898a68150f225f2e=function(){return s(new Array)},t.wbg.__wbg_new_b51585de1b234aff=function(){return s(new Object)},t.wbg.__wbg_set_502d29070ea18557=function(e,t,r){n(e)[t>>>0]=o(r)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){return s(new Error)},t.wbg.__wbg_stack_658279fe44541cf6=function(t,r){const o=h(n(r).stack,e.__wbindgen_export_0,e.__wbindgen_export_1),s=_;b()[t/4+1]=s,b()[t/4+0]=o},t.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let r,o;try{r=t,o=n,console.error(u(t,n))}finally{e.__wbindgen_export_2(r,o,1)}},t.wbg.__wbindgen_debug_string=function(t,r){const o=h(f(n(r)),e.__wbindgen_export_0,e.__wbindgen_export_1),s=_;b()[t/4+1]=s,b()[t/4+0]=o},t.wbg.__wbindgen_throw=function(e,t){throw new Error(u(e,t))},t}async function m(t){if(void 0!==e)return e;void 0===t&&(t=new URL("sf2_synth_audio_worklet_wasm_bg.wasm",document.currentScript&&document.currentScript.src||new URL("processor.js",document.baseURI).href));const n=p();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:o}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await t,n);return function(t,n){return e=t.exports,m.__wbindgen_wasm_module=n,g=null,c=null,e}(r,o)}class x extends AudioWorkletProcessor{synth;sf2Bytes;constructor(){super(),this.port.onmessage=e=>{this.onmessage(e)},this.synth=void 0,this.sf2Bytes=void 0}onmessage(e){const t=e.data;switch(t.type){case"send-wasm-module":m(WebAssembly.compile(t.wasmBytes)).then((()=>{this.port.postMessage({type:"wasm-module-loaded"})})).catch((()=>{console.error("An error occurred during wasm initialization")})),this.sf2Bytes=t.sf2Bytes;break;case"init-synth":{if(null==this.sf2Bytes)throw new Error("sf2Bytes is undefined");this.synth=y.new(new Uint8Array(this.sf2Bytes),t.sampleRate);const e={type:"init-completed-synth"};this.port.postMessage(e);break}case"note-on":this.noteOn(t.channel,t.key,t.vel,t.delayTime);break;case"note-off":this.noteOff(t.channel,t.key,t.delayTime);break;case"get-preset-headers":this.getPresetHeaders();break;case"set-program":this.setProgram(t.channel,t.bank,t.preset)}}noteOn(e,t,n,r){null!=this.synth&&this.synth.note_on(e,t,n,r)}noteOff(e,t,n){null!=this.synth&&this.synth.note_off(e,t,n)}getPresetHeaders(){if(null==this.synth)return;const e={type:"got-preset-headers",presetHeaders:this.synth.get_preset_headers()};this.port.postMessage(e)}setProgram(e,t,n){null!=this.synth&&this.synth.program_select(e,t,n)}process(e,t){if(null==this.synth)return!0;const n=t[0],r=n[0].length,o=this.synth.read_next_block(r);return n[0].set(o[0]),n.length>1&&n[1].set(o[1]),!0}}registerProcessor("sf2-synth-processor",x)}();
//# sourceMappingURL=processor.js.map
