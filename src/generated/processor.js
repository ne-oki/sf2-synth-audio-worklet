!function(){"use strict";!function(t){function n(){}function e(){}n.prototype.encode=function(t){for(var n=[],e=t.length,r=0;r<e;){var o=t.codePointAt(r),s=0,i=0;for(o<=127?(s=0,i=0):o<=2047?(s=6,i=192):o<=65535?(s=12,i=224):o<=2097151&&(s=18,i=240),n.push(i|o>>s),s-=6;s>=0;)n.push(128|o>>s&63),s-=6;r+=o>=65536?2:1}return n},globalThis.TextEncoder=n,t.TextEncoder||(t.TextEncoder=n),e.prototype.decode=function(t){if(!t)return"";for(var n="",e=0;e<t.length;){var r=t[e],o=0,s=0;if(r<=127?(o=0,s=255&r):r<=223?(o=1,s=31&r):r<=239?(o=2,s=15&r):r<=244&&(o=3,s=7&r),t.length-e-o>0)for(var i=0;i<o;)s=s<<6|63&(r=t[e+i+1]),i+=1;else s=65533,o=t.length-e;n+=String.fromCodePoint(s),e+=o+1}return n},globalThis.TextDecoder=e,t.TextDecoder||(t.TextDecoder=e)}(typeof globalThis==""+void 0?typeof global==""+void 0?typeof self==""+void 0?void 0:self:global:globalThis);const t="send-wasm-module",n="wasm-module-loaded",e="init-synth",r="note-on",o="note-off";let s;const i=new Array(32).fill(void 0);function c(t){return i[t]}i.push(void 0,null,!0,!1);let a=i.length;function f(t){const n=c(t);return function(t){t<36||(i[t]=a,a=t)}(t),n}function u(t){a===i.length&&i.push(i.length+1);const n=a;return a=i[n],i[n]=t,n}const _=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});_.decode();let l=new Uint8Array;function w(){return 0===l.byteLength&&(l=new Uint8Array(s.memory.buffer)),l}function b(t,n){return _.decode(w().subarray(t,t+n))}function h(t){const n=typeof t;if("number"==n||"boolean"==n||null==t)return`${t}`;if("string"==n)return`"${t}"`;if("symbol"==n){const n=t.description;return null==n?"Symbol":`Symbol(${n})`}if("function"==n){const n=t.name;return"string"==typeof n&&n.length>0?`Function(${n})`:"Function"}if(Array.isArray(t)){const n=t.length;let e="[";n>0&&(e+=h(t[0]));for(let r=1;r<n;r++)e+=", "+h(t[r]);return e+="]",e}const e=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(!(e.length>1))return toString.call(t);if(r=e[1],"Object"==r)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:r}let g=0;const y=new TextEncoder("utf-8"),d="function"==typeof y.encodeInto?function(t,n){return y.encodeInto(t,n)}:function(t,n){const e=y.encode(t);return n.set(e),{read:t.length,written:e.length}};function p(t,n,e){if(void 0===e){const e=y.encode(t),r=n(e.length);return w().subarray(r,r+e.length).set(e),g=e.length,r}let r=t.length,o=n(r);const s=w();let i=0;for(;i<r;i++){const n=t.charCodeAt(i);if(n>127)break;s[o+i]=n}if(i!==r){0!==i&&(t=t.slice(i)),o=e(o,r,r=i+3*t.length);const n=w().subarray(o+i,o+r);i+=d(t,n).written}return g=i,o}let m=new Int32Array;function A(){return 0===m.byteLength&&(m=new Int32Array(s.memory.buffer)),m}function x(t){return null==t}class v{static __wrap(t){const n=Object.create(v.prototype);return n.ptr=t,n}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();s.__wbg_wasmsoundfontsynth_free(t)}static new(t,n){const e=function(t,n){const e=n(1*t.length);return w().set(t,e/1),g=t.length,e}(t,s.__wbindgen_export_0),r=g,o=s.wasmsoundfontsynth_new(e,r,n);return v.__wrap(o)}get_preset_headers(){return f(s.wasmsoundfontsynth_get_preset_headers(this.ptr))}program_select(t,n,e){s.wasmsoundfontsynth_program_select(this.ptr,t,n,e)}note_on(t,n,e,r){s.wasmsoundfontsynth_note_on(this.ptr,t,n,e,!x(r),x(r)?0:r)}note_off(t,n,e){s.wasmsoundfontsynth_note_off(this.ptr,t,n,!x(e),x(e)?0:e)}read_next_block(t){return f(s.wasmsoundfontsynth_read_next_block(this.ptr,t))}}function T(){const t={wbg:{}};return t.wbg.__wbindgen_object_drop_ref=function(t){f(t)},t.wbg.__wbindgen_object_clone_ref=function(t){return u(c(t))},t.wbg.__wbindgen_number_new=function(t){return u(t)},t.wbg.__wbindgen_string_new=function(t,n){return u(b(t,n))},t.wbg.__wbg_set_20cbc34131e76824=function(t,n,e){c(t)[f(n)]=f(e)},t.wbg.__wbg_new_1d9a920c6bfc44a8=function(){return u(new Array)},t.wbg.__wbg_new_0b9bfdd97583284e=function(){return u(new Object)},t.wbg.__wbg_set_a68214f35c417fa9=function(t,n,e){c(t)[n>>>0]=f(e)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){return u(new Error)},t.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const e=p(c(n).stack,s.__wbindgen_export_0,s.__wbindgen_export_1),r=g;A()[t/4+1]=r,A()[t/4+0]=e},t.wbg.__wbg_error_f851667af71bcfc6=function(t,n){try{console.error(b(t,n))}finally{s.__wbindgen_export_2(t,n)}},t.wbg.__wbindgen_debug_string=function(t,n){const e=p(h(c(n)),s.__wbindgen_export_0,s.__wbindgen_export_1),r=g;A()[t/4+1]=r,A()[t/4+0]=e},t.wbg.__wbindgen_throw=function(t,n){throw new Error(b(t,n))},t}async function k(t){void 0===t&&(t=new URL("sf2_synth_audio_worklet_wasm_bg.wasm",document.currentScript&&document.currentScript.src||new URL("processor.js",document.baseURI).href));const n=T();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:r}=await async function(t,n){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,n)}catch(n){if("application/wasm"==t.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,n)}{const e=await WebAssembly.instantiate(t,n);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}(await t,n);return function(t,n){return s=t.exports,k.__wbindgen_wasm_module=n,m=new Int32Array,l=new Uint8Array,s}(e,r)}class O extends AudioWorkletProcessor{synth;sf2Bytes;constructor(){super(),this.port.onmessage=t=>this.onmessage(t),this.synth=void 0,this.sf2Bytes=void 0}onmessage(s){const i=s.data;if(i.type===t)k(WebAssembly.compile(i.wasmBytes)).then((()=>{this.port.postMessage({type:n})})),this.sf2Bytes=i.sf2Bytes;else if(i.type===e){if(!this.sf2Bytes)throw new Error("sf2Bytes is undefined");this.synth=v.new(new Uint8Array(this.sf2Bytes),i.sampleRate)}else i.type===r?this.noteOn(i.channel,i.key,i.vel,i.delayTime):i.type===o&&this.noteOff(i.channel,i.key,i.delayTime)}noteOn(t,n,e,r){this.synth&&this.synth.note_on(t,n,e,r)}noteOff(t,n,e){this.synth&&this.synth.note_off(t,n,e)}process(t,n){if(!this.synth)return!0;const e=n[0],r=e[0].length,o=this.synth.read_next_block(r);return e[0].set(o[0]),e.length>1&&e[1].set(o[1]),!0}}registerProcessor("sf2-synth-processor",O)}();
//# sourceMappingURL=processor.js.map
