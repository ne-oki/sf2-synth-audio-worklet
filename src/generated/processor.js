!function(){"use strict";!function(t){function e(){}function n(){}e.prototype.encode=function(t){for(var e=[],n=t.length,r=0;r<n;){var s=t.codePointAt(r),o=0,i=0;for(s<=127?(o=0,i=0):s<=2047?(o=6,i=192):s<=65535?(o=12,i=224):s<=2097151&&(o=18,i=240),e.push(i|s>>o),o-=6;o>=0;)e.push(128|s>>o&63),o-=6;r+=s>=65536?2:1}return e},globalThis.TextEncoder=e,t.TextEncoder||(t.TextEncoder=e),n.prototype.decode=function(t){if(!t)return"";for(var e="",n=0;n<t.length;){var r=t[n],s=0,o=0;if(r<=127?(s=0,o=255&r):r<=223?(s=1,o=31&r):r<=239?(s=2,o=15&r):r<=244&&(s=3,o=7&r),t.length-n-s>0)for(var i=0;i<s;)o=o<<6|63&(r=t[n+i+1]),i+=1;else o=65533,s=t.length-n;e+=String.fromCodePoint(o),n+=s+1}return e},globalThis.TextDecoder=n,t.TextDecoder||(t.TextDecoder=n)}(typeof globalThis==""+void 0?typeof global==""+void 0?typeof self==""+void 0?void 0:self:global:globalThis);const t="send-wasm-module",e="wasm-module-loaded",n="init-synth",r="note-on",s="note-off",o="get-preset-headers",i="got-preset-headers",c="set-program";let a;const f=new Array(32).fill(void 0);function u(t){return f[t]}f.push(void 0,null,!0,!1);let _=f.length;function l(t){const e=u(t);return function(t){t<36||(f[t]=_,_=t)}(t),e}function h(t){_===f.length&&f.push(f.length+1);const e=_;return _=f[e],f[e]=t,e}const g=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});g.decode();let y=new Uint8Array;function w(){return 0===y.byteLength&&(y=new Uint8Array(a.memory.buffer)),y}function b(t,e){return g.decode(w().subarray(t,t+e))}function d(t){const e=typeof t;if("number"==e||"boolean"==e||null==t)return`${t}`;if("string"==e)return`"${t}"`;if("symbol"==e){const e=t.description;return null==e?"Symbol":`Symbol(${e})`}if("function"==e){const e=t.name;return"string"==typeof e&&e.length>0?`Function(${e})`:"Function"}if(Array.isArray(t)){const e=t.length;let n="[";e>0&&(n+=d(t[0]));for(let r=1;r<e;r++)n+=", "+d(t[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(!(n.length>1))return toString.call(t);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:r}let p=0;const m=new TextEncoder("utf-8"),A="function"==typeof m.encodeInto?function(t,e){return m.encodeInto(t,e)}:function(t,e){const n=m.encode(t);return e.set(n),{read:t.length,written:n.length}};function x(t,e,n){if(void 0===n){const n=m.encode(t),r=e(n.length);return w().subarray(r,r+n.length).set(n),p=n.length,r}let r=t.length,s=e(r);const o=w();let i=0;for(;i<r;i++){const e=t.charCodeAt(i);if(e>127)break;o[s+i]=e}if(i!==r){0!==i&&(t=t.slice(i)),s=n(s,r,r=i+3*t.length);const e=w().subarray(s+i,s+r);i+=A(t,e).written}return p=i,s}let v=new Int32Array;function T(){return 0===v.byteLength&&(v=new Int32Array(a.memory.buffer)),v}function k(t){return null==t}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_wasmsoundfontsynth_free(t)}static new(t,e){const n=function(t,e){const n=e(1*t.length);return w().set(t,n/1),p=t.length,n}(t,a.__wbindgen_export_0),r=p,s=a.wasmsoundfontsynth_new(n,r,e);return O.__wrap(s)}get_preset_headers(){return l(a.wasmsoundfontsynth_get_preset_headers(this.ptr))}program_select(t,e,n){a.wasmsoundfontsynth_program_select(this.ptr,t,e,n)}note_on(t,e,n,r){a.wasmsoundfontsynth_note_on(this.ptr,t,e,n,!k(r),k(r)?0:r)}note_off(t,e,n){a.wasmsoundfontsynth_note_off(this.ptr,t,e,!k(n),k(n)?0:n)}read_next_block(t){return l(a.wasmsoundfontsynth_read_next_block(this.ptr,t))}}function S(){const t={wbg:{}};return t.wbg.__wbindgen_object_drop_ref=function(t){l(t)},t.wbg.__wbindgen_object_clone_ref=function(t){return h(u(t))},t.wbg.__wbindgen_number_new=function(t){return h(t)},t.wbg.__wbindgen_string_new=function(t,e){return h(b(t,e))},t.wbg.__wbg_set_20cbc34131e76824=function(t,e,n){u(t)[l(e)]=l(n)},t.wbg.__wbg_new_1d9a920c6bfc44a8=function(){return h(new Array)},t.wbg.__wbg_new_0b9bfdd97583284e=function(){return h(new Object)},t.wbg.__wbg_set_a68214f35c417fa9=function(t,e,n){u(t)[e>>>0]=l(n)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){return h(new Error)},t.wbg.__wbg_stack_658279fe44541cf6=function(t,e){const n=x(u(e).stack,a.__wbindgen_export_0,a.__wbindgen_export_1),r=p;T()[t/4+1]=r,T()[t/4+0]=n},t.wbg.__wbg_error_f851667af71bcfc6=function(t,e){try{console.error(b(t,e))}finally{a.__wbindgen_export_2(t,e)}},t.wbg.__wbindgen_debug_string=function(t,e){const n=x(d(u(e)),a.__wbindgen_export_0,a.__wbindgen_export_1),r=p;T()[t/4+1]=r,T()[t/4+0]=n},t.wbg.__wbindgen_throw=function(t,e){throw new Error(b(t,e))},t}async function B(t){void 0===t&&(t=new URL("sf2_synth_audio_worklet_wasm_bg.wasm",document.currentScript&&document.currentScript.src||new URL("processor.js",document.baseURI).href));const e=S();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,e);return function(t,e){return a=t.exports,B.__wbindgen_wasm_module=e,v=new Int32Array,y=new Uint8Array,a}(n,r)}class R extends AudioWorkletProcessor{synth;sf2Bytes;constructor(){super(),this.port.onmessage=t=>this.onmessage(t),this.synth=void 0,this.sf2Bytes=void 0}onmessage(i){const a=i.data;if(a.type===t)B(WebAssembly.compile(a.wasmBytes)).then((()=>{this.port.postMessage({type:e})})),this.sf2Bytes=a.sf2Bytes;else if(a.type===n){if(!this.sf2Bytes)throw new Error("sf2Bytes is undefined");this.synth=O.new(new Uint8Array(this.sf2Bytes),a.sampleRate)}else a.type===r?this.noteOn(a.channel,a.key,a.vel,a.delayTime):a.type===s?this.noteOff(a.channel,a.key,a.delayTime):a.type===o?this.getPresetHeaders():a.type===c&&this.setProgram(a.channel,a.bank,a.preset)}noteOn(t,e,n,r){this.synth&&this.synth.note_on(t,e,n,r)}noteOff(t,e,n){this.synth&&this.synth.note_off(t,e,n)}getPresetHeaders(){if(!this.synth)return;const t=this.synth.get_preset_headers();this.port.postMessage({type:i,presetHeaders:t})}setProgram(t,e,n){this.synth&&this.synth.program_select(t,e,n)}process(t,e){if(!this.synth)return!0;const n=e[0],r=n[0].length,s=this.synth.read_next_block(r);return n[0].set(s[0]),n.length>1&&n[1].set(s[1]),!0}}registerProcessor("sf2-synth-processor",R)}();
//# sourceMappingURL=processor.js.map
